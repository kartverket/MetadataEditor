function updateShoppingCart(){var e=$("#orderitem-count"),t="",o={},a="orderitems",r=0,n=".geonorge.no";null!==localStorage.getItem("orderItems")&&"[]"!=localStorage.getItem("orderItems")&&(t=localStorage.getItem("orderItems")),""!==t?(e.css("display","block"),o=JSON.parse(t),r=o.length,e.html(r)):0!==Cookies.get(a)&&null!==Cookies.get(a)?(r=Cookies.get(a),e.css("display","block"),e.html(r)):e.css("display","none"),Cookies.set(a,r,{expires:7,path:"/",domain:n})}function updateShoppingCartCookie(){var e=$("#orderitem-count"),t="orderitems",o=".geonorge.no",a=0;if(null!==localStorage.getItem("orderItems")&&"[]"!=localStorage.getItem("orderItems")){var r=localStorage.getItem("orderItems"),n=JSON.parse(r);a=n.length,e.html(a)}else a=0,e.css("display","none");Cookies.set(t,a,{expires:7,path:"/",domain:o})}angular.module("geonorge",["ui.bootstrap"]),angular.module("geonorge").config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["**"])}]);var searchOptionsArray={dev:{text:"Kartkatalogen",searchTitle:"Kartkatalogen",buttonCss:"edgesKartkatalogen",listCss:"left-edge-kartkatalogen",baseUrl:"//kartkatalog.dev.geonorge.no",url:"//kartkatalog.dev.geonorge.no/search",api:"//kartkatalog.dev.geonorge.no/api/search",queryParameter:"?text=",localUrl:!1,autoComplete:!0,geonorgeUrl:"//www.test.geonorge.no"},test:{text:"Kartkatalogen",searchTitle:"Kartkatalogen",buttonCss:"edgesKartkatalogen",listCss:"left-edge-kartkatalogen",baseUrl:"//kartkatalog.test.geonorge.no",url:"//kartkatalog.test.geonorge.no/search",api:"//kartkatalog.test.geonorge.no/api/search",queryParameter:"?text=",localUrl:!1,autoComplete:!0,geonorgeUrl:"//www.test.geonorge.no"},prod:{text:"Kartkatalogen",searchTitle:"Kartkatalogen",buttonCss:"edgesKartkatalogen",listCss:"left-edge-kartkatalogen",baseUrl:"//kartkatalog.geonorge.no",url:"//kartkatalog.geonorge.no/search",api:"//kartkatalog.geonorge.no/api/search",queryParameter:"?text=",localUrl:!1,autoComplete:!0,geonorgeUrl:"//www.geonorge.no"}},searchOption=searchOptionsArray.prod;if(""!==applicationEnvironment&&null!==applicationEnvironment)var searchOption=searchOptionsArray[applicationEnvironment];var baseurl_local=searchOption.baseUrl;!function(){var e=angular.module("geonorge");e.service("aggregatedService",["$http","$q",function(e,t){function o(e){s=e}function a(e){return t(function(t){void 0===s?t():s(e)})}function r(o,a,r,n){var l=encodeURI(searchOption.api+"?limit=5&facets[1]name=type&facets[1]value=dataset&text="+o),s=e({method:"GET",url:l,headers:{"Content-Type":"application/json; charset=utf-8",accept:"*/*"},data:{}}),c=encodeURI(searchOption.api+"?limit=5&facets[1]name=type&facets[1]value=servicelayer&text="+o),u=e({method:"GET",url:c,headers:{"Content-Type":"application/json; charset=utf-8",accept:"*/*"},data:{}});return t.all([s,u])}var n=document.getElementById("txtLang"),l="";n&&(l=n.value);var s=void 0;return{triggerSearch:a,executeMethod:o,performSearch:r}}]).controller("searchTopController",["$rootScope","$scope","$location","$window","$timeout","aggregatedService","$sce",function(e,t,o,a,r,n,l){function s(){var o=t.selectedSearch,r="";""!==e.searchQuery&&(r=o.queryParameter,r+=e.searchQuery);var n=o.url+r;a.location.href=n}function c(e){if(t.ajaxCallActive=!1,t.autoCompleteResult=[],e.d){var o=[];if(0===e.d.NumberOfHitsTotal)return void(t.autoCompleteResult=[]);o=e.d.Results;for(var a=0;a<o.length;a++){var r={},n=o[a];if(0!==n.data.Results.length){r.type=n.Section,r.title=n.SectionName,r.list=[];for(var l=0;l<n.data.Results.length;l++){var s=n.data.Results[l];r.title=u(s.Type),r.list.push({externalId:n.SectionName+"_"+n.Section+"_"+l,id:l,typeId:n.Section,title:s.Title,url:s.ShowDetailsUrl})}t.autoCompleteResult.push(r),console.log(r)}}}}function u(e){switch(e){case"dataset":return"Datasett";case"servicelayer":return"WMS-lag (Tjenestelag)"}}function i(){k>0&&1==v&&(k--,0===k&&(v=null)),1==k&&v>1&&(v--,k=t.autoCompleteResult[v-1].list.length),v>1&k>1&&k--,p()}function g(){null===v?(v=1,k=1):(v==t.autoCompleteResult.length&&t.autoCompleteResult[v-1].list.length>k&&k++,v<t.autoCompleteResult.length&&(t.autoCompleteResult[v-1].list.length>k?k++:(v++,k=1))),p()}function p(){for(var e=0;e<t.autoCompleteResult.length;e++){var o=t.autoCompleteResult[e];if(e==v-1)for(var a=0;a<o.list.length;a++){var r=o.list[a];a==k-1?r.highlight=!0:r.highlight=!1}else for(var n=0;n<o.list.length;n++)o.list[n].highlight=!1}console.log("categoryCount "+v),console.log("resultCount "+k)}e.trustHtml=function(e){return l.trustAsHtml(e)},t.dropdownOpen=!1,t.extendedSearchOpen=!1,t.showFakeResults=!1,t.searchString="",e.selectedSearch=searchOption,e.searchQuery=parseLocation(window.location.search).text,t.autoCompleteResult=[],t.autoCompletePartial="/Content/bower_components/kartverket-felleskomponenter/assets/partials/_autoCompleteRow.html",t.focused=!1,t.autocompleteActive=!1,t.ajaxCallActive=!1,t.allowBlur=!0,t.viewport={width:window.innerWidth,height:window.innerHeight},t.breakpoints={xSmall:480,small:768,medium:992,large:1200};var d=function(o,a){o.preventDefault(),o.stopPropagation(),e.selectedSearch=a,t.dropdownOpen=!1;var r=document.getElementById("txtSearch");r.focus()};t.select=d;var h=function(e){var t;switch(e.keyCode){case 38:e.target.blur(),t=angular.element(e.target).next(),t.children()[dropdownOptions.length-1].focus();break;case 40:e.target.blur(),t=angular.element(e.target).next(),t.children()[0].focus();break;default:return}e.preventDefault(),e.stopPropagation()},m=function(e,t){var o;switch(e.keyCode){case 13:return void d(e,dropdownOptions[t]);case 38:var a=angular.element(document.getElementById("search-dropdown"));o=0===t?a.children()[dropdownOptions.length-1]:a.children()[t-1];break;case 40:o=t>=dropdownOptions.length-1?angular.element(document.getElementById("search-dropdown")).children()[0]:angular.element(e.target).next()[0];break;default:return}e.target.blur(),o.focus(),e.preventDefault(),e.stopPropagation()};t.dropdownKeyDown=m,t.buttonDropdownKeyDown=h,t.onSearch=function(t){if(t&&t.preventDefault(),!(e.searchQuery.length<3)){var o=n.triggerSearch(e.searchQuery);o.then(s)}},t.preventDefault=function(e){switch(e.keyCode){case 13:e.preventDefault();break;case 16:w=!0;break;case 9:t.autoCompleteResult.length>0&&e.preventDefault();break;case 38:case 40:e.preventDefault()}};var f=null;t.autocomplete=function(o){if(t.focused!==!1){if(e.searchQuery.length<3)return t.autoCompleteResult=[],t.autocompleteActive=!1,t.ajaxCallActive=!1,void(v=null);switch(o.keyCode){case 13:null===v?(t.resetAutocomplete(),t.allowBlur=!0,t.onSearch(o)):(t.allowBlur=!1,window.location=t.autoCompleteResult[v-1].list[k-1].url);break;case 16:w=!1;break;case 37:break;case 38:return i(),!1;case 39:break;case 9:w?i():g();break;case 40:return g(),!1;default:return v=null,f&&(r.cancel(f),f=null,console.log("cancel timeout")),void(f=r(function(){t.autocompleteActive=!0,console.log("calling WS"),e.searchQuery.length>0&&(t.ajaxCallActive=!0,n.performSearch(e.searchQuery,[],5,0).then(function(e){console.log(e);var t={d:{Results:e}};c(t)}))},300))}}};var v=null,k=null,w=!1;t.mouseOver=function(e,o,a){console.log(o),console.log(a),t.allowBlur=e,k=a+1,v=o+1,p()},t.mouseOut=function(e){t.allowBlur=e},t.resetAutocomplete=function(){t.focused=!1,t.autocompleteActive=!1,t.ajaxCallActive=!1,t.autoCompleteResult=[]},t.setFocus=function(e){t.focused=!0,console.log(t.focused),angular.element(e.target).on("blur",function(){r(function(){t.allowBlur&&(t.resetAutocomplete(),console.log(t.focused),angular.element(e.target).on("blur",null))},!0)})},angular.element(document).ready(function(){n.triggerSearch(e.searchQuery)})}])}();var parseLocation=function(e){var t,o,a=e.substring(1).split("&"),r={};for(o in a)""!==a[o]&&(t=a[o].split("="),r[decodeURIComponent(t[0])]=decodeURIComponent(t[1]));return r},baseurl="http://"+window.location.host;$(document).ready(function(){$(".page-wizard .page-wizard-tab").on("click",function(){$(".page-wizard").toggleClass("open")});var e=$("<li class='jose'><ul></ul></li>");$("<p>te</p>").appendTo($(e).find("ul"))}),function(){var e=angular.module("geonorge"),t=searchOption.geonorgeUrl;e.controller("menuTopController",["$scope","$http",function(e,o){function a(t){localStorage.setItem("menuItems",JSON.stringify(t));var o=new Date,a=3;o.setTime(o.getTime()+60*a*1e3),Cookies.set("expire","menu",{expires:o}),e.menuItems=t.data}function r(){e.getMenuError=!0}e.getMenuData=function(){if(!Cookies.get("expire")||!localStorage.getItem("menuItems")){var n=t+"/api/menu",l=o({method:"GET",url:n,headers:{"Content-Type":"application/json; charset=utf-8"},data:{}});return console.log("Menu loaded from server"),l.then(a,r)}console.log("Menu loaded locally"),response=JSON.parse(localStorage.getItem("menuItems")),e.menuItems=response.data}}])}(),$(window).load(function(){var e={disable_search_threshold:10,search_contains:!0};$(".chosen-select").chosen(e),$('[data-toggle="tooltip"]').tooltip();var t=document.documentElement;t.setAttribute("data-useragent",navigator.userAgent)}),$(window).load(function(){updateShoppingCart()});