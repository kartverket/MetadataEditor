@model Kartverket.MetadataEditor.Models.MetadataViewModel
@using Resources

@if (!Model.IsSoftware())
{
    <div class="form-group">
        <label class="col-sm-2 control-label">Produktspesifikasjon (URL)</label>
        <div class="col-sm-9">
            @Html.EditorFor(m => m.ProductSpecificationUrl, new { htmlAttributes = new { @class = "form-control" } })
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label">Produktark (URL)</label>
        <div class="col-sm-9">
            @Html.EditorFor(m => m.ProductSheetUrl, new { htmlAttributes = new { @class = "form-control" } })
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label">Tegneregler (URL)</label>
        <div class="col-sm-9">
            @Html.EditorFor(m => m.LegendDescriptionUrl, new { htmlAttributes = new { @class = "form-control" } })
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label">Produktside (URL)</label>
        <div class="col-sm-9">
            @Html.EditorFor(m => m.ProductPageUrl, new { htmlAttributes = new { @class = "form-control" } })
        </div>
    </div>
    if (Model.IsDataset() || Model.IsDatasetSeries())
    {
        <div class="form-group">
            <label class="col-sm-2 control-label">Dekningsoversikt</label>
            <div class="col-sm-9">
                <select id="coverageType" name="coverageType" class="form-control" onchange="showCoverageType(this.value);">
                    <option value="webpage">Dekningsoversikt er tilgjengelig i egen webside</option>
                    <option value="mapservice">Dekningsoversikt er tilgjengelig i eget tjenestekartlag</option>
                </select>
            </div>
        </div>
    <div class="form-group" id="coverageWebsite">
        <label class="col-sm-2 control-label"></label>
        <div class="col-sm-9">
            <label class="control-label" for="CoverageUrl">Webside:</label>
            @Html.EditorFor(m => m.CoverageUrl, new { htmlAttributes = new { @class = "form-control" } })
        </div>
    </div>
    <div class="form-group" id="coverageServiceMap">
        <label class="col-sm-2 control-label"></label>
        <div class="col-sm-9">
            <input type="radio" value="WMS" id="WMSid" name="coverageMapType" onchange="setCoverage()" class="coverageMapTypes" />WMS
            <input type="radio" value="WFS" id="WFSid" name="coverageMapType" onchange="setCoverage()" class="coverageMapTypes" />WFS
            <input type="radio" value="GeoJSON" id="GeoJSONid" name="coverageMapType" onchange="setCoverage()" class="coverageMapTypes" />GeoJSON
            <br />
            <label class="control-label" for="coveragePath">Url til tjeneste:</label><input class="form-control" type="text" id="coveragePath" name="coveragePath" onchange="setCoverage()" />
            <br />
            <label class="control-label" for="coverageLayer">Navn på kartlag:</label><input class="form-control" type="text" id="coverageLayer" name="coverageLayer" onchange="setCoverage()" />
        </div>
    </div>
    }
}
@if (Model.IsDataset() || Model.IsDatasetSeries())
{
<script>
    function showCoverageType(coverageT) {

        if (coverageT == 'mapservice') {
            document.getElementById('coverageWebsite').style.display = "none";
            document.getElementById('coverageWebsite').style.visibility = "hidden";
            document.getElementById('coverageServiceMap').style.display = "block";
            document.getElementById('coverageServiceMap').style.visibility = "visible";

        }
        else {
            document.getElementById('coverageWebsite').style.display = "block";
            document.getElementById('coverageWebsite').style.visibility = "visible";
            document.getElementById('coverageServiceMap').style.display = "none";
            document.getElementById('coverageServiceMap').style.visibility = "hidden";
        }
    }

    function setCoverage() {


        var coverageMapType = document.querySelector('.coverageMapTypes:checked').value;
        var coveragePath = document.getElementById('coveragePath').value;
        var coverageLayer = document.getElementById('coverageLayer').value;
        document.getElementById('CoverageUrl').value = 'TYPE:' + coverageMapType + '@@PATH:' + coveragePath + '@@LAYER:' + coverageLayer;


    }

    function getCoverage() {
        var coverageStr = '@Model.CoverageUrl';
        var endPosType = coverageStr.search('@@PATH');
        var typeStr = coverageStr.substring(5, endPosType);
        if (typeStr == 'WMS')
            document.getElementById("WMSid").checked = true;
        else if(typeStr == 'WFS')
            document.getElementById("WFSid").checked = true;
        else if (typeStr == 'GeoJSON')
            document.getElementById("GeoJSONid").checked = true;


        var endPath = coverageStr.search('@@LAYER');
        var pathStr = coverageStr.substring(endPosType + 6, endPath);
        document.getElementById('coveragePath').value = pathStr;

        var startLayer = endPath + 7;
        var endLayer = coverageStr.length - startLayer;
        var layerStr = coverageStr.substr(startLayer, endLayer);
        document.getElementById('coverageLayer').value = layerStr;

    }

    @if (!string.IsNullOrEmpty(Model.CoverageUrl) && Model.CoverageUrl.IndexOf("TYPE:") > -1)
    {
        @: showCoverageType('mapservice')
        @: document.getElementById('coverageType').options[1].selected = true;
        @: getCoverage();
                }
    else
    {
        @: showCoverageType('webpage')
            }


</script>
}    
<div class="panel panel-default">
    <div class="panel-heading required">Grafisk bilde<div class="pull-right"><a href="#" data-help-text-id="help-text-Image" class="badge help-text-toggle">?</a></div></div>
    <div class="panel-body">
        <p class="help-text bg-success" id="help-text-Image" style="display: none">@UI.Helptext_Image</p>
        <div class="form-group required has-feedback">
            <label class="col-sm-2 control-label">Type</label>
            <div class="col-sm-2">
                <select id="thumbnailType" class="@ViewBag.thumbnailMissingCSS form-control">
                    <option value="miniatyrbilde">Miniatyrbilde</option>
                    <option value="large_thumbnail">Stort bilde</option>
                    <option value="dekningsoversikt">Dekningsoversikt</option>
                </select>
                <span class="glyphicon glyphicon-warning-sign form-control-feedback"></span>
            </div>
            <div>
                @Html.ValidationMessage("thumbnailMissing", "Du må angi bildefil eller angi URL for miniatyrbilde")
            </div>
        </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">Angi bildefil</label>
                <div class="col-sm-8">
                    <div class="form-group" id="uploadThumbnail">
                        <div class="col-sm-7">
                            <input type="file" id="uploadThumbnailFile" class="filestyle" data-buttontext="Velg fil" onchange="document.getElementById('uploadMode').value = 'upload';"  />
                        </div>
                        <div class="col-sm-5">
                            <label class="control-label"><input type="checkbox" id="uploadScaleImage" checked="checked" name="scaleImage" /> Skalering til miniatyrbilde</label>
                        </div>

                    </div>
                    <div id="uploadThumbnailStatus"></div>
                </div>
            </div>


            <div class="form-group">
                <label class="col-sm-2 control-label">Eller angi URL</label>
                <div class="col-sm-5">
                    <input id="thumbnailUrl" onfocus="document.getElementById('uploadMode').value = 'reference';" type="text" class="form-control" />
                </div>
                <div class="col-sm-3">
                </div>
                    <div class="col-sm-1">
                        <input type="hidden" id="uploadMode" value="reference" />
                        <button class="btn btn-default" style="display: none; visibility:hidden;" id="thumbnailAdd"></button>
                        <button class="btn btn-default" type="submit" id="uploadThumbnailButton" onclick="return checkIfUrlRef();">Legg til</button>
                        <script>
                            function checkIfUrlRef() {
                                if (document.getElementById('thumbnailUrl').value != '' && document.getElementById('uploadMode').value == 'reference') {
                                    document.getElementById('thumbnailAdd').click();
                                    return false;
                                }
                            }
                        </script>

                    </div>
                </div>

            <ul id="thumbnails">
                @for (int i = 0; i < Model.Thumbnails.Count; i++)
                {
                    var thumbnail = Model.Thumbnails[i];

                    <li class="thumbnail clearfix">
                        <input type="hidden" name="Thumbnails[@i].Type" value="@thumbnail.Type" />
                        <input type="hidden" name="Thumbnails[@i].URL" value="@thumbnail.URL" />
                        <img src="@thumbnail.URL" width="200" class="pull-left" style="margin-right: 10px;" />
                        <p><strong>Type:</strong>@( thumbnail.Type == "thumbnail" ? new HtmlString("miniatyrbilde") : new HtmlString(thumbnail.Type))</p>
                        <p><strong>URL:</strong> <small>@thumbnail.URL</small></p>
                        <button class="thumbnailRemove btn btn-default pull-right"><span class="glyphicon glyphicon-trash"></span> Slett</button>
                    </li>
                }
            </ul>

        </div>
</div>

